##A file to place miscellaneous R commands


##To get classified read counts from the dataframe
library(tidyverse)

#Check this imports zotus not otus
files<-list.files(path="./",pattern="*taxa_counts.txt")
taxa_dataframe<-lapply(files,read.delim, header=FALSE)
names(taxa_dataframe)<-files 

#Dataframes
taxa_dataframe<-lapply(taxa_dataframe, setNames, paste0(c("OTU", "Read_Count", "Kingdom", "Phylum", "Class", "Order", "Genus")))
Reads_dataframe<-lapply(taxa_dataframe,function(y) {y %>% group_by(Genus) %>% summarise(Read_Count=sum(Read_Count))})
Reads_total<-lapply(taxa_dataframe, function(z) sum(z$Read_Count))



##Make graphs
library(readxl)
library(RColorBrewer)
library(tidyverse)
library(factoextra)

#Read in and set up
#Change sheet name
freq_sheet <- read_excel("_freq.xlsx")
freq<-as.matrix(freq_sheet[-1])
row.names(freq)<-freq_sheet$Genus
colnames(freq)=gsub(pattern = ".16S.il.2019.12.19.taxa_counts",replacement = " ",x=colnames(freq))

#Heatmap graph
freqheatmap <- heatmap(freq, Rowv=NA, Colv=NA, col =brewer.pal(9,"Blues"), scale="column", margins=c(9,2),cexCol = 0.65, main = "Heatmap of frequency of genus in cow samples")

#PCA graph
freqdf<-as.data.frame(freq)
freqtb<-as_tibble(freqdf)
tfreqtb<-t(freqdf)

#Change the column numbers
freq.pca<-prcomp(tfreqtb[c(2:6),])
fviz_pca_ind(freq.pca,
   col.var = "contrib", # Color by contributions to the PC
   gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),
   repel = TRUE,  select.var = list(contrib=10)   # Avoid text overlapping
